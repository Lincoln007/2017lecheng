@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta charset="UTF-8">
    <title>乐诚</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <!-- load css -->
    <link rel="stylesheet" type="text/css" href="~/css/bootstrap.min.css" media="all">
    <link rel="stylesheet" type="text/css" href="~/css/font/iconfont.css" media="all">
    <link rel="stylesheet" type="text/css" href="~/css/layui.css" media="all">
    <link rel="stylesheet" type="text/css" href="~/css/jqadmin.css" media="all">
    <link rel="stylesheet" type="text/css" href="~/css/main.css?v1.0.0" media="all">

</head>
<body>
    <div class="container-fluid larry-wrapper">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12">
                <!--头部搜索-->

                <div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
                    <ul class="layui-tab-title">
                        <li class="layui-this">添加新产品</li>                       
                        <li>其他</li>
                    </ul>
                    <div class="layui-tab-content">
                        <div class="layui-tab-item layui-show">
                            <table class="layui-table" lay-skin="line">
                                <tr>
                                    <td><label>产品款号:&nbsp;</label><input type="text" name="" id='Code' onblur="aa()" /></td>
                                </tr>
                                <tr>
                                    <td><label>商品名称:&nbsp;</label><input type="text" name="" id="proname" /></td>
                                </tr>
                                <tr>
                                    <td><label>报关名称:&nbsp;</label><input type="text" name="" id="bgname" /></td>
                                </tr>
                                <tr>
                                    <td><label>报关编号:&nbsp;</label><input type="text" name="" id="bgcode" /></td>
                                </tr>
                                <tr>
                                    <td><label>报关价格:&nbsp;</label><input type="text" name="" id="bgprice" />(USD)</td>
                                </tr>
                                <tr>
                                    <td><label>预估重量:&nbsp;</label><input type="text" name="" id="weight" />g</td>
                                </tr>
                                <tr>
                                    <td><label>参考价格:&nbsp;</label><input type="text" name="" id="price" />(RMB)</td>
                                </tr>
                                <tr>
                                    <td><label>产品备注:&nbsp;</label><input type="text" name="" style="width:80%" placeholder="填写如：采购注意（三双一组等），品牌，注意事项，材料等" id="remark" /></td>
                                </tr>
                                <tr>
                                    <td>
                                        <label>产品类别:&nbsp;</label>
                                        <select id="clasf">
                                            <option value="0">普货</option>
                                            <option value="1" selected>仿货</option>
                                        </select>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

                                        <label>产品分类:&nbsp;</label>
                                        <select id="profly">
                                            <option value="0">衣服</option>
                                            <option value="1" selected>工具</option>
                                            <option value="2">母婴</option>
                                        </select>
                                    </td>
                                </tr>
                                @*<tr>
                                        <td>
                                            <label>供应商:&nbsp;&nbsp;</label>
                                            <input type="text" name="" id="suppname"/>&nbsp;&nbsp;&nbsp;&nbsp;
                                            <label>采购链接:</label><input type="text" name="" placeholder="采购实际链接" style="width:65%" id="linkID"/>
                                        </td>
                                    </tr>*@
                                <tr>
                                    <td>
                                        <label>颜色/型号:&nbsp;</label><input type="text" name="Model" style="width:30%" id="promodel" />
                                        <input type="text" id="ms" value="1" style="width:5%;text-align:center">
                                        <label>---</label>
                                        <input type="text" id="me" value="8" style="width:5%;text-align:center">
                                        <button class="layui-btn  layui-btn-small" onclick="createColorOrModel()">生成</button>
                                        <label style="color:red">用01,02,03序号表示并用英文逗号分隔，最多生成50个，亦可手写</label>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label>尺码/大小:&nbsp;</label><input type="text" name="Size" style="width:30%" id="prosize" />
                                        <input type="text" id="cs" value="S" style="width:5%;text-align:center">
                                        <label>---</label>
                                        <input type="text" id="ce" value="XXXL" style="width:5%;text-align:center">
                                        <button class="layui-btn  layui-btn-small" onclick="createSize()">生成</button>
                                        <label style="color:red">英文逗号分隔，亦可手写</label>
                                    </td>
                                </tr>
                                <tr>
                                    <td><button class="layui-btn layui-btn-normal" onclick="createSKU()">生成SKU</button></td>
                                </tr>
                            </table>
                            <div>
                                <table class="layui-table">
                                    <thead>
                                        <tr style="background-color:#5CB85C">
                                            <th>SKU</th>
                                            <th>状态</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tbody">
                                        @*<tr>
                                            <td>bk188-01-00</td>
                                            <td>销售中</td>
                                            <td><button class="layui-btn layui-btn-small layui-btn-danger">删除</button></td>
                                        </tr>*@
                                    </tbody>
                                </table>
                                <div>
                                    <input type="text" placeholder="SKU" style="height:30px;" id="addsku">&nbsp;&nbsp;&nbsp;&nbsp;<button class="layui-btn layui-btn-small" onclick="AddSKU()">添加SKU</button>
                                </div>
                                <div style="margin-top:10px;">
                                    <button class="layui-btn" id="confime" onclick="AddPro()">确认添加</button>
                                </div>

                            </div>
                        </div>
                        <div class="layui-tab-item">
                            <table class="layui-table" lay-skin="line">
                                <tr>
                                    <td>
                                        <label>供应商:&nbsp;&nbsp;</label>
                                        <input type="text" name="" id="suppname" />&nbsp;&nbsp;&nbsp;&nbsp;
                                        <label>采购链接:</label><input type="text" name="" placeholder="采购实际链接" style="width:65%" id="linkID" />
                                    </td>
                                </tr>
                                <tr>
                                    <td></td>
                                </tr>
                            </table>
                        </div>                      
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="~/Scripts/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="~/Scripts/layui/layui.js"></script>

    <script type="text/javascript">


        function GetallSKU() {
            var body = $("#tbody");
            var tr = body.children('tr');
            var skulist = new Array();　//创建一个数组
            tr.each(function (i) {
                var mysku = $(this).children().eq(0).text();
                skulist.push(mysku);
            });
            return skulist;
        }
        function AddPro() {
            var code = $("#Code").val().trim();//款号
            var proname = $("#proname").val().trim();//商品名称
            var bgname = $("#bgname").val().trim();//报关名称
            var bgcode = $("#bgcode").val().trim();//报关编码
            var bgprice = $("#bgprice").val().trim();//报关价格
            var weight = $("#weight").val().trim();//重量
            var price = $("#price").val().trim();//参考价格
            var remark = $("#remark").val().trim();//备注
            var clasf = $("#clasf").val();//分类
            var profly = $("#profly").val().trim();//商品分类
            var promodel = $("#promodel").val();//颜色型号
            var prosize = $("#prosize").val().trim();//尺码大小
            var skulist = GetallSKU();
            if (code == "") {
                $('#Code').focus();
                layer.msg("款号不能为空");
                return false;
            }
            if (proname == "") {
                $('#proname').focus();
                layer.msg("商品名称不能为空");
                return false;
            }
            if (bgcode == "") {
                $('#bgcode').focus();
                layer.msg("报关编码不能为空");
                return false;
            }
            if (bgprice == "") {
                $('#bgprice').focus();
                layer.msg("报关价格不能为空");
                return false;
            }
            //添加新产品
            $.post('@Url.Content("~/NewProduct/AddNewProduct")', {
                code: code, proname: proname, bgname:bgname,bgcode: bgcode, bgprice: bgprice, weight: weight,
                price: price, remark: remark, clasf: clasf, profly: profly, promodel: promodel, prosize: prosize, skulist: skulist
            },
                function (data) {
                    if (data.State == 1) {
                        layer.msg(data.Msg, { icon: 6, time: 2000 });
                    } else {
                        layer.msg(data.Msg);
                    }
                })

        }
        //判断款号是否可用
        function aa() {
            var code = $("#Code").val();
            $.post('@Url.Content("~/NewProduct/PcodeIsEixt")', { code: code }, function (data) {
                if (data.State == 1) {
                    layer.msg(data.Msg, { icon: 6, time: 1000 });
                } else {
                    layer.msg(data.Msg);
                }
            })
        }
        function createColorOrModel() {
            var s = $('#ms').val() - 0;
            var e = $('#me').val() - 0;
            if (s > e || e > 50) {
                return "";
            }
            var arr = [];
            for (var i = s; i <= e; i++) {
                if (i < 10 && i >= 0) {
                    arr.push("0" + i);
                } else {
                    arr.push(i);
                }
            }
            $('input[name=Model]').val(arr.join(',')).blur();
        }

        function createSize() {
            var array = ["S", "M", "L", "XL", "2XL", "3XL", "4XL", "5XL", "6XL", "7XL"];
            for (var i = 0; i <= 100; i++) {
                if (i < 10 && i >= 0) {
                    array.push("0" + i);
                } else {
                    array.push(i);
                }
            }
            var s = $('#cs').val();
            var e = $('#ce').val();
            if (/^[X]{2,7}L$/.test(e)) {
                e = e.split('X').length - 1 + "XL";
            }

            if (/\d/.test(s)) {
                if ((s - 0) < 10) {
                    s = "0" + s;
                }
            }
            if (/\d/.test(e)) {
                if ((e - 0) < 10) {
                    e = "0" + e;
                }
            }
            var si = 0, ei = 0;
            for (var i = 0; i < array.length; i++) {
                if (s == array[i]) {
                    si = i;
                }
                else if (e == array[i]) {
                    ei = i;
                }
            }
            var arr = [];
            for (var i = si; i <= ei; i++) {
                arr.push(array[i]);
            }
            $('input[name=Size]').val(arr.join(',')).blur();
        }

        function createSKU() {
            if ($('input[name=Size]').val() == "" && $('input[name=Model]').val() == "") {
                createColorOrModel();
                createSize();
            }

            if ($.trim($('#Code').val()) == "") {
                $('#Code').focus();
                layer.msg("款号不能为空");
                return false;
            }
            var code = $("#Code").val();
            var model = $("input[name=Model]").val().split(',');
            var size = $("input[name=Size]").val().split(',');
            //var yw = $("input[name=YWeight]").val() - 0;
            //var pr = $("input[name=PriceR]").val() - 0;
            var arr = [];
            for (var i = 0; i < model.length; i++) {
                for (var j = 0; j < size.length; j++) {
                    var sku = {};
                    sku.Code = code + "-" + model[i] + "-" + size[j];
                    //sku.YWeight = yw;
                    sku.SWeight = 0;
                    //sku.PriceR = pr;
                    sku.PurPrice = 0;
                    sku.SaltNum = 0;
                    sku.Num = 0;
                    arr.push(sku);
                }
            }
            $('#tbody').children().remove();
            Build(arr);
        }
        //绑定数据到表格
        function Build(list) {
            var body = $("#tbody");
            var totiltext;
            for (var i = 0; i < list.length; i++) {
                var mtext = "<tr>";
                mtext = mtext + buildTr(list[i]);
                mtext = mtext + "</tr>";
                totiltext = totiltext + mtext;
            }
            body.append(totiltext);
        }
        function buildTr(tr) {
            var trContent = "<td>" + tr.Code + "</td>";
            trContent += "<td>" + tr.PurPrice + "</td>";
            trContent += "<td><input type='button' class='layui-btn layui-btn-mini layui-btn-normal' onclick='DeleteSKU(this)' value='删除'/></td>";
            return trContent;
        }
        function DeleteSKU(curr) {
            $(curr).parent().parent().remove();
        }

        var isexit;
        function AddSKU() {
            var code = $("#addsku").val().trim();
            if (code == "") {
                layer.msg("请先填写SKU,并且款号等信息必须正确");
                return false;
            }
            checkIsExit(code);
            if (isexit == "1")//代表存在
            {
                isexit = 0;
                return;
            } else {
                var body = $("#tbody");
                body.append("<tr><td>" + code + "</td><td>0</td><td><input type='button' class='layui-btn layui-btn-mini layui-btn-normal' onclick='DeleteSKU(this)' value='删除'/></td></tr>");
            }

        }

        function checkIsExit(sku) {
            var body = $("#tbody");
            var tr = body.children('tr');

            tr.each(function (i) {
                var mysku = $(this).children().eq(0).text();
                if (mysku == sku) {
                    isexit = 1;
                    layer.msg("已存在此SKU，不能重复添加");
                    return false;
                }
            });
        }
        //$.post("/NewProduct/AddProduct", { username: userid, password: password, ValidCode: ValidCode, remember: remember }, function (data) {
        //    layer.close(wait);
        //    if (data.State == 1) {
        //        layer.msg("登录成功");
        //        window.location = data.URL;
        //    } else {
        //        layer.msg("登录失败,原因:" + data.Msg);
        //    }
        //})

    </script>
    <script>

        $(function () {
            layui.use(['form', 'layer', 'laypage', 'element', 'upload'], function () {
                var form = layui.form()
                      , layer = layui.layer
                     , laypage = layui.laypage
                     , element = layui.element(),
                     upload = layui.upload;

                layui.upload({
                    url: '/test/upload.json'
                 , elem: '#mainimg' //指定原始元素，默认直接查找class="layui-upload-file"
                 , method: 'post' //上传接口的http类型
                 , success: function (res) {
                     LAY_demo_upload.src = res.url;
                 }
                });
                  
                $("#uploadmainImg").click(function ()
                {
                   // alert("123123");
                    $("#mainimg").click();
                });

                Getproclsfly();
                function Getproclsfly() {
                    $.post('@Url.Content("~/GetDropDownList/GetProductClasfly")', {}, function (data) {
                        $('#profly').children().remove();
                        for (var i = 0; i < data.length; i++) {

                            $('#profly').append("<option value='" + data[i].prod_class_id + "'>" + data[i].class_name + "</option>"); //为Select追加一个Option(下拉项)
                        }
                        form.render('select');
                    })
                }

            })

        })


    </script>
</body>

</html>






